---
- name: Update pip & related tools
  pip:
    name: pip
    state: latest
    virtualenv: "{{ virtualenv_path }}"
    virtualenv_python: "{{ openwisp2_wireguard_python }}"
    virtualenv_site_packages: true
    virtualenv_command: "{{ openwisp2_wireguard_virtualenv_command }}"
  retries: 5
  delay: 10
  register: result
  until: result is success
  notify: reload supervisor

- name: Read local requirements.txt
  local_action: command cat /path/to/requirements.txt
  register: requirements

- name: Install Python modules from requirements.txt
  pip:
    name: "{{ requirements.stdout_lines }}"
    state: present
    virtualenv: "{{ virtualenv_path }}"
    virtualenv_python: "{{ openwisp2_wireguard_python }}"
    virtualenv_site_packages: true
    virtualenv_command: "{{ openwisp2_wireguard_virtualenv_command }}"
  notify: reload supervisor
  retries: 5
  delay: 10
  register: result
  until: result is success
